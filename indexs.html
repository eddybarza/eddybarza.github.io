<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Reporte de Inversiones</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .reload-section {
            padding: 20px 30px;
            text-align: center;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .reload-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
        }
        
        .reload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 18px;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            font-size: 16px;
            background: #f8d7da;
            margin: 20px;
            border-radius: 10px;
            border: 2px solid #f5c6cb;
        }
        
        .content {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .comparison-block {
            margin-bottom: 40px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .comparison-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        
        .section {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .nuevas {
            background: #d4edda;
            color: #155724;
        }
        
        .cerradas {
            background: #f8d7da;
            color: #721c24;
        }
        
        .cambios {
            background: #fff3cd;
            color: #856404;
        }
        
        .sin-cambios {
            background: #e2e3e5;
            color: #383d41;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            color: #495057;
        }
        
        td {
            padding: 12px 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .positive {
            color: #28a745;
            font-weight: 600;
        }
        
        .negative {
            color: #dc3545;
            font-weight: 600;
        }
        
        .symbol {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .empty-message {
            color: #6c757d;
            font-style: italic;
            padding: 10px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Visor de Reporte de Inversiones</h1>
            <p>An√°lisis de diferencias en posiciones de cartera</p>
        </div>
        
        <div class="reload-section">
            <button class="reload-btn" onclick="loadReport()">
                üîÑ Recargar Reporte
            </button>
            <p style="margin-top: 10px; color: #6c757d; font-size: 14px;">
                Archivo: reporte_diferencias.txt
            </p>
        </div>
        
        <div class="content" id="content">
            <div class="loading">‚è≥ Cargando reporte...</div>
        </div>
    </div>
    
    <script>
        // Cargar el reporte autom√°ticamente al iniciar
        window.addEventListener('DOMContentLoaded', function() {
            loadReport();
        });
        
        function loadReport() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">‚è≥ Cargando reporte...</div>';
            
            // Intentar cargar desde la ruta relativa
            fetch('reporte_diferencias.txt')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('No se pudo cargar el archivo');
                    }
                    return response.text();
                })
                .then(text => {
                    parseAndDisplay(text);
                })
                .catch(error => {
                    content.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Error al cargar el archivo</h3>
                            <p style="margin-top: 10px;">${error.message}</p>
                            <p style="margin-top: 15px; font-size: 14px;">
                                Aseg√∫rate de que el archivo <strong>reporte_diferencias.txt</strong> 
                                est√© en la misma carpeta que este HTML.
                            </p>
                        </div>
                    `;
                });
        }
        
        function parseAndDisplay(text) {
            const content = document.getElementById('content');
            content.innerHTML = '';
            
            const lines = text.split('\n');
            let currentComparison = null;
            let currentSection = null;
            let inTable = false;
            let tableData = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.includes('COMPARANDO:')) {
                    if (currentComparison && currentSection) {
                        addTableToSection(currentSection, tableData);
                    }
                    currentComparison = createComparisonBlock(line);
                    content.appendChild(currentComparison);
                    inTable = false;
                    tableData = [];
                }
                else if (line.startsWith('[+]')) {
                    if (currentSection) {
                        addTableToSection(currentSection, tableData);
                    }
                    currentSection = createSection('nuevas', line);
                    if (currentComparison) {
                        currentComparison.appendChild(currentSection);
                    }
                    inTable = !line.includes('No hay nuevas posiciones');
                    tableData = [];
                }
                else if (line.startsWith('[-]')) {
                    if (currentSection) {
                        addTableToSection(currentSection, tableData);
                    }
                    currentSection = createSection('cerradas', line);
                    if (currentComparison) {
                        currentComparison.appendChild(currentSection);
                    }
                    inTable = !line.includes('No se cerraron posiciones');
                    tableData = [];
                }
                else if (line.startsWith('[*]')) {
                    if (currentSection) {
                        addTableToSection(currentSection, tableData);
                    }
                    currentSection = createSection('cambios', line);
                    if (currentComparison) {
                        currentComparison.appendChild(currentSection);
                    }
                    inTable = !line.includes('Sin cambios');
                    tableData = [];
                }
                else if (inTable && line && !line.includes('====') && !line.includes('S√≠mbolo')) {
                    if (line.includes('S√≠mbolo')) {
                        continue;
                    }
                    const rowData = parseTableRow(line);
                    if (rowData) {
                        tableData.push(rowData);
                    }
                }
            }
            
            if (currentSection && tableData.length > 0) {
                addTableToSection(currentSection, tableData);
            }
            
            if (content.children.length === 0) {
                content.innerHTML = '<div class="error">‚ö†Ô∏è No se encontr√≥ informaci√≥n para mostrar</div>';
            }
        }
        
        function createComparisonBlock(title) {
            const block = document.createElement('div');
            block.className = 'comparison-block';
            
            const header = document.createElement('div');
            header.className = 'comparison-header';
            header.textContent = title.replace('COMPARANDO:', 'üìÖ Comparaci√≥n:');
            
            block.appendChild(header);
            return block;
        }
        
        function createSection(type, title) {
            const section = document.createElement('div');
            section.className = 'section';
            
            const titleDiv = document.createElement('div');
            titleDiv.className = `section-title ${type}`;
            
            let icon = '';
            if (type === 'nuevas') icon = '‚úÖ ';
            else if (type === 'cerradas') icon = '‚ùå ';
            else if (type === 'cambios') icon = 'üîÑ ';
            
            titleDiv.textContent = icon + title.substring(3);
            section.appendChild(titleDiv);
            
            return section;
        }
        
        function parseTableRow(line) {
            line = line.trim();
            if (!line || line.startsWith('S√≠mbolo') || line.includes('====')) return null;
            
            const parts = line.split(/\s{2,}/);
            if (parts.length < 3) return null;
            
            return parts.map(p => p.trim()).filter(p => p);
        }
        
        function addTableToSection(section, data) {
            if (data.length === 0) return;
            
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');
            
            const firstRow = data[0];
            let headers = [];
            
            if (firstRow[0].startsWith('+') || firstRow[0].startsWith('-')) {
                headers = ['', 'S√≠mbolo', 'Invrs', 'Invertido', 'Unidades', 'Nombre'];
            } else if (firstRow[0].startsWith('*')) {
                headers = ['', 'S√≠mbolo', 'Dif. Inv ($)', 'Dif. Uni', 'Dif. Invrs', 'Totales Actuales', 'Nombre'];
            }
            
            const headerRow = document.createElement('tr');
            headers.forEach(h => {
                const th = document.createElement('th');
                th.textContent = h;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            data.forEach(rowData => {
                const tr = document.createElement('tr');
                rowData.forEach((cell, idx) => {
                    const td = document.createElement('td');
                    
                    if (idx === 0 && (cell === '+' || cell === '-' || cell === '*')) {
                        td.textContent = cell;
                        td.style.fontWeight = 'bold';
                        td.style.fontSize = '18px';
                    } else if (idx === 1) {
                        td.textContent = cell;
                        td.className = 'symbol';
                    } else if (cell.startsWith('+')) {
                        td.textContent = cell;
                        td.className = 'positive';
                    } else if (cell.startsWith('$-') || cell.startsWith('-')) {
                        td.textContent = cell;
                        td.className = 'negative';
                    } else {
                        td.textContent = cell;
                    }
                    
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            
            table.appendChild(thead);
            table.appendChild(tbody);
            section.appendChild(table);
        }
    </script>
</body>
</html>
